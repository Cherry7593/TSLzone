# TSLzone - 区域伤害插件

TSLzone 是一个专为 Folia 1.21+ 服务端设计的区域伤害插件，允许服务器管理员创建指定区域，对区域内的实体按设定的伤害值和频率进行持续伤害。

## ✨ 功能特色

- 🎯 **精确区域控制** - 通过选点系统精确定义伤害区域
- ⚡ **Folia 兼容** - 专为 Folia 1.21+ 服务端优化，支持多线程架构
- 🔧 **灵活配置** - 可自定义伤害值、伤害频率
- 💾 **数据持久化** - 所有区域配置自动保存，服务器重启后自动恢复
- 🛡️ **安全限制** - 区域大小限制防止服务器性能问题
- 🎨 **消息自定义** - 完全可自定义的消息系统
- 🔄 **热重载** - 支持配置文件热重载，无需重启服务器

## 🚀 快速开始

### 安装步骤

1. 下载 `TSLzone-1.0.jar` 插件文件
2. 将插件文件放入服务器的 `plugins` 文件夹
3. 重启服务器或使用 `plugman` 加载插件
4. 插件将自动生成配置文件

### 基本使用流程

1. **设置选点** - 使用 `/tzone pos1` 和 `/tzone pos2` 设置区域的两个对角点
2. **创建区域** - 使用 `/tzone create <区域名> <伤害值> <频率>` 创建区域
3. **启动区域** - 使用 `/tzone start <区域名>` 开始对区域内实体造成伤害
4. **管理区域** - 使用各种命令管理已创建的区域

## 📋 命令详解

### 基础命令
- **主命令**: `/tslzone` 或 `/tzone`
- **权限**: `tslzone.use` (基础使用) / `tslzone.admin` (管理功能)

### 选点命令
```
/tzone pos1    # 设置选区的第一个点（当前玩家位置）
/tzone pos2    # 设置选区的第二个点（当前玩家位置）
```

### 区域管理命令
```
/tzone create <区域名> <伤害值> <频率>    # 创建新区域
/tzone start <区域名>                   # 启动指定区域的伤害
/tzone stop <区域名>                    # 停止指定区域的伤害
/tzone remove <区域名>                  # 删除指定区域
/tzone list                            # 列出所有区域及其状态
```

### 系统命令
```
/tzone reload    # 重载所有配置文件
/tzone help      # 显示帮助信息
```

## 🎮 使用示例

### 创建一个伤害区域

1. 首先移动到区域的一个角落，执行：
   ```
   /tzone pos1
   ```
   
2. 移动到区域的对角位置，执行：
   ```
   /tzone pos2
   ```

3. 创建区域（名称为"danger_zone"，每次造成2点伤害，每5秒执行一次）：
   ```
   /tzone create danger_zone 2 5
   ```

4. 启动区域：
   ```
   /tzone start danger_zone
   ```

现在，任何进入该区域的生物都会每5秒受到2点伤害！

### 管理现有区域

- 查看所有区域：
  ```
  /tzone list
  ```

- 临时停止某个区域：
  ```
  /tzone stop danger_zone
  ```

- 重新启动区域：
  ```
  /tzone start danger_zone
  ```

- 完全删除区域：
  ```
  /tzone remove danger_zone
  ```

## ⚙️ 配置文件

### data.yml
区域数据自动保存在 `plugins/TSLzone/data.yml` 中，包含：
- 区域坐标信息
- 伤害设置
- 频率设置
- 激活状态

示例配置：
```yaml
zones:
  danger_zone:
    pos1:
      world: world
      x: 100.0
      y: 64.0
      z: 200.0
    pos2:
      world: world
      x: 150.0
      y: 80.0
      z: 250.0
    damage: 2.0
    frequency: 5
    active: true
```

### messages.yml
自定义所有插件消息，支持颜色代码：
```yaml
# 颜色代码: &0-&9, &a-&f, &l(粗体), &o(斜体), &n(下划线), &m(删除线), &k(混淆), &r(重置)
zone:
  create:
    success: "&a成功创建区域 &e'%s' &a！"
    success-info: "&e伤害: &7%s &e| 频率: &7%s秒"
```

## 🔒 权限系统

| 权限节点 | 描述 | 默认 |
|---------|------|------|
| `tslzone.use` | 基础使用权限（pos1, pos2, list） | OP |
| `tslzone.admin` | 管理员权限（create, start, stop, remove, reload） | OP |

### 权限配置示例 (LuckPerms)
```
# 给予玩家基础使用权限
/lp user <玩家名> permission set tslzone.use true

# 给予管理员完整权限
/lp user <管理员> permission set tslzone.admin true
```

## 🛡️ 安全与限制

### 区域大小限制
- **最大区域**: 500×500×500 方块
- **目的**: 防止过大区域影响服务器性能
- **检查时机**: 区域创建时自动检查

### 性能优化
- 使用 Folia 的区域调度器，确保线程安全
- 智能实体检测，只处理区域内的生物
- 异常处理机制，防止插件崩溃

## 🔧 故障排除

### 常见问题

**Q: 创建区域失败，提示"区域太大"**
A: 确保选择的区域不超过 500×500×500 方块。可以使用 `/tzone list` 查看区域大小。

**Q: 区域不造成伤害**
A: 检查区域是否已启动（`/tzone list` 查看状态），确保区域内有生物实体。

**Q: 服务器重启后区域消失**
A: 检查 `plugins/TSLzone/data.yml` 文件是否存在且可读写。

**Q: 命令没有权限**
A: 确保拥有 `tslzone.use` 或 `tslzone.admin` 权限。

### 调试信息
启用调试模式查看详细日志：
1. 查看服务器控制台输出
2. 检查插件是否正确加载
3. 使用 `/tzone reload` 重载配置

## 📝 更新日志

### v1.0.0
- ✨ 初始版本发布
- ✅ 完整的区域管理系统
- ✅ Folia 1.21+ 完全兼容
- ✅ 可自定义消息系统
- ✅ 数据持久化支持

## 🤝 支持与反馈

如果您在使用过程中遇到问题或有改进建议，请：
1. 检查本文档的故障排除部分
2. 确保使用的是 Folia 1.21+ 服务端
3. 联系插件开发者报告问题

## 📄 许可证

本插件遵循 MIT 许可证，您可以自由使用、修改和分发。

---

**感谢使用 TSLzone！** 🎉

*让您的服务器区域管理更加简单高效！*
